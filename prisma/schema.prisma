generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("SUPABASE_URL")
}

model Callback {
  id            String                @id @default(uuid())
  name          String
  dateCallback  DateTime
  status        Status                @default(WAITING_CALL)
  createdAt     DateTime              @default(now())
  discountEndAt DateTime?
  comment       String?
  contactMethod ContactMethod         @default(GOOGLE_MEET)
  email         String
  phone         String
  timeSlot      String
  country       String
  language      String
  timeZone      String
  reservations  CallbackReservation[]
}

model CallbackReservation {
  id         String    @id @default(uuid())
  date       DateTime
  time       String
  expiresAt  DateTime
  createdAt  DateTime  @default(now())
  callbackId String?
  callback   Callback? @relation(fields: [callbackId], references: [id])
}

model User {
  id                String            @id @default(cuid())
  email             String            @unique
  name              String
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  stripeCustomerId  String?
  sellerId          String?
  skoolSubscription Boolean?          @default(false)
  skoolUserEmail    String?           @unique
  skoolUserId       String?
  bookCover         ChoicedBookCover  @default(HARD_COVER)
  skoolSubDate      String?
  skoolUserLastName String?
  skoolUserName     String?
  selectedVarId     String?
  isBookDiscount    Boolean           @default(false)
  sessions          CheckoutSession[]
  payments          Payment[]
  subscriptions     Subscription[]
  seller            Seller?           @relation(fields: [sellerId], references: [id])
}

model Seller {
  id        String            @id @default(cuid())
  name      String
  lastName  String
  avatar    String?
  email     String            @unique
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  sessions  CheckoutSession[]
  users     User[]
}

model Subscription {
  id               String             @id @default(cuid())
  stripeId         String             @unique
  userId           String?
  email            String
  status           SubscriptionStatus
  startDate        DateTime
  currentPeriodEnd DateTime
  createdAt        DateTime
  updatedAt        DateTime
  payments         Payment[]
  user             User?              @relation(fields: [userId], references: [id])
}

model Payment {
  id             String        @id @default(cuid())
  stripeId       String        @unique
  subscriptionId String?
  userId         String?
  amount         Int
  currency       String        @default("usd")
  status         PaymentStatus
  paidAt         DateTime
  subscription   Subscription? @relation(fields: [subscriptionId], references: [id])
  user           User?         @relation(fields: [userId], references: [id])
}

model SubscriptionPlan {
  id             String                 @id @default(cuid())
  subName        String
  subDescription String?
  subStatus      SubscriptionPlanStatus
  paymentLink    String
  amount         Int
  priceId        String
}

model CheckoutSession {
  id          String         @id @default(cuid())
  sellerId    String
  userId      String?
  status      CheckoutStatus @default(PENDING)
  createdAt   DateTime       @default(now())
  stripeId    String         @unique
  amountTotal Int
  clientEmail String
  seller      Seller         @relation(fields: [sellerId], references: [id])
  user        User?          @relation(fields: [userId], references: [id])
}

enum Status {
  WAITING_CALL
  PURCHASED
}

enum ContactMethod {
  PHONE_CALL
  GOOGLE_MEET
  SOMEWHERE_ELSE
}

enum ChoicedBookCover {
  SOFT_COVER
  HARD_COVER
}

enum SubscriptionStatus {
  active
  trialing
  past_due
  canceled
  incomplete
}

enum SubscriptionPlanStatus {
  active
  deactivate
}

enum PaymentStatus {
  pending
  succeeded
  failed
  refunded
}

enum CheckoutStatus {
  PENDING
  COMPLETED
  EXPIRED
}
